-- =========================================================
-- DOCTOR MANAGEMENT SYSTEM
-- =========================================================



-- =========================================================
-- UC-2.1 : ADD DOCTOR PROFILE
-- =========================================================

-- Create Specialties Table

CREATE TABLE specialties (
    specialty_id INT PRIMARY KEY AUTO_INCREMENT,
    specialty_name VARCHAR(60) UNIQUE NOT NULL
);

-- Output:
-- Query OK, 0 rows affected



-- Create Doctors Table

CREATE TABLE doctors (
    doctor_id INT PRIMARY KEY AUTO_INCREMENT,
    doctor_name VARCHAR(60) NOT NULL,
    contact VARCHAR(15) UNIQUE,
    consultation_fee DECIMAL(8,2),
    specialty_id INT,
    is_active BOOLEAN DEFAULT TRUE,
    FOREIGN KEY (specialty_id) REFERENCES specialties(specialty_id)
);

-- Output:
-- Query OK, 0 rows affected



-- Insert Specialties

INSERT INTO specialties (specialty_name) VALUES
('Cardiology'),
('Neurology'),
('Orthopedics'),
('General Medicine');

-- Output:
-- Query OK, 4 rows affected



-- Add Doctors

INSERT INTO doctors
(doctor_name, contact, consultation_fee, specialty_id)
VALUES
('Anamika Mishra','9100011111',800.00,4),
('Raj Sharma','9100022222',1200.00,1),
('Peter Pedigrew','9100033333',1500.00,2);

-- Output:
-- Query OK, 3 rows affected



-- =========================================================
-- UC-2.2 : ASSIGN / UPDATE DOCTOR SPECIALTY
-- =========================================================

START TRANSACTION;

UPDATE doctors
SET specialty_id = 1
WHERE doctor_id = 1;

COMMIT;

-- Output:
-- Query OK, 1 row affected



-- =========================================================
-- CREATE DOCTOR SCHEDULE TABLE
-- =========================================================

CREATE TABLE doctor_schedule (
    schedule_id INT PRIMARY KEY AUTO_INCREMENT,
    doctor_id INT NOT NULL,
    available_day VARCHAR(15),
    time_slot VARCHAR(30),
    FOREIGN KEY (doctor_id) REFERENCES doctors(doctor_id)
);

-- Output:
-- Query OK, 0 rows affected



-- Insert Schedule

INSERT INTO doctor_schedule
(doctor_id, available_day, time_slot)
VALUES
(1,'Monday','10:00-13:00'),
(1,'Wednesday','14:00-17:00'),
(2,'Tuesday','09:00-12:00'),
(3,'Friday','11:00-15:00');

-- Output:
-- Query OK, 4 rows affected



-- =========================================================
-- UC-2.3 : VIEW DOCTORS BY SPECIALTY
-- =========================================================

SELECT
    d.doctor_id,
    d.doctor_name,
    s.specialty_name,
    sch.available_day,
    sch.time_slot
FROM doctors d
JOIN specialties s
     ON d.specialty_id = s.specialty_id
JOIN doctor_schedule sch
     ON d.doctor_id = sch.doctor_id
WHERE s.specialty_name = 'Cardiology'
AND d.is_active = TRUE;

-- Output:
-- +-----------+----------------+----------------+---------------+-------------+
-- | doctor_id | doctor_name    | specialty_name | available_day | time_slot   |
-- +-----------+----------------+----------------+---------------+-------------+
-- | 1         | Anamika Mishra | Cardiology     | Monday        | 10:00-13:00 |
-- | 1         | Anamika Mishra | Cardiology     | Wednesday     | 14:00-17:00 |
-- | 2         | Raj Sharma     | Cardiology     | Tuesday       | 09:00-12:00 |
-- +-----------+----------------+----------------+---------------+-------------+



-- =========================================================
-- CREATE APPOINTMENTS TABLE
-- =========================================================

CREATE TABLE appointments (
    appointment_id INT PRIMARY KEY AUTO_INCREMENT,
    doctor_id INT NOT NULL,
    appointment_date DATE NOT NULL,
    FOREIGN KEY (doctor_id) REFERENCES doctors(doctor_id)
);

-- Output:
-- Query OK, 0 rows affected



-- Insert Appointments

INSERT INTO appointments
(doctor_id, appointment_date)
VALUES
(1,'2026-02-10'),
(2,'2026-02-11'),
(3,'2026-02-20');

-- Output:
-- Query OK, 3 rows affected



-- =========================================================
-- UC-2.4 : DEACTIVATE DOCTOR PROFILE
-- =========================================================

UPDATE doctors
SET is_active = FALSE
WHERE doctor_id = 3
AND doctor_id NOT IN (
    SELECT doctor_id
    FROM appointments
    WHERE appointment_date > CURDATE()
);

-- Output:
-- Query OK, 0 rows affected
-- (Doctor not deactivated due to future appointment)



-- Verify Doctor Status

SELECT doctor_id, doctor_name, is_active
FROM doctors;

-- Output:
-- +-----------+----------------+-----------+
-- | doctor_id | doctor_name    | is_active |
-- +-----------+----------------+-----------+
-- | 1         | Anamika Mishra | 1         |
-- | 2         | Raj Sharma     | 1         |
-- | 3         | Peter Pedigrew | 1         |
-- +-----------+----------------+-----------+



-- =========================================================
-- END OF DOCTOR MANAGEMENT MODULE
-- (UC-2.1 to UC-2.4 COMPLETED)
-- =========================================================
